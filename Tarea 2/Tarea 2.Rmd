---
title: "Tarea 2"
author: "Matias Bajac, Lucas Pescetto, Andres Vidal"
date: "`r Sys.Date()`"
output:
  pdf_document: default
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}

library(haven)
library(tidyverse)
library(survey)

knitr::opts_chunk$set(echo = TRUE)
```

```{r}

marco_cerro_largo <- read_sav("Marco_2011_con_barrio_y_Sec_po_savl.sav") %>% 
  filter(dpto == "04" & codloc != 4900) %>% 
  mutate(
    codloc = case_when(
                  codloc == 4987 ~ 4220,
                  codloc == 4983 ~ 4220,
                  codloc == 4825 ~ 4220,
                   TRUE ~ codloc
                ),
    nomloc = case_when(
                  nomloc == "BARRIO LA VINCHUCA" ~ "MELO",
                  nomloc == "BARRIO LOPEZ BENITEZ" ~ "MELO",
                  nomloc == "HIPODROMO" ~ "MELO",
                   TRUE ~ nomloc
                  
                )
    )

  
# poblaci√≥n por localidad

poblaciones <- marco_cerro_largo %>% 
  group_by(localidades) %>%
  summarise(pob_loc = sum(pob), v_tot = sum(hogares), zonas = n())


etapa1= marco_cerro_largo %>%  group_by(localidades,zonas) %>% summarise(x= sum(hogares), nz = n(),sd_x=sd(hogares)) 

estratos = etapa1 %>%  arrange(desc(x)) %>%  mutate(estrato = cut(x, breaks=c(0,200,1500,5000,Inf), right = FALSE))  %>% filter(x<5000)

estratos2 = estratos %>%  group_by(estrato) %>% summarise(Mh = n(), kh= sum(x), Nh= sum(nz))



tamanio = estratos2 %>%  mutate(mh=round(5*Mh/sum(Mh)), nh=5*Nh) ## asignacion proporcional al tamanio de cada estrato 

estratos = estratos %>%  arrange(estrato)
set.seed(1234)
upm_sample=sampling::strata(estratos,  
                        stratanames='estrato', 
size=tamanio$mh, ## numero de localidades sorteadas x estrato 
method = 'systematic',
pik= estratos$x, # le paso la probabiliad de inclusion proporcional al tamanio de hogares 
description = TRUE)

usm_sample = sampling::getdata(estratos,upm_sample) # tomo la muestra 





```

